<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link type="text/css" rel="stylesheet" href="css/css/style.css">
    <script src="less/less.js/test/less.js"></script>


</head>
<body>
    <h1>学生信息</h1>
    <div>
        <button type="button" id="addBtn">添加</button>
    </div>
    <div>
        学生姓名:<input type="text" name="sName" id="sName">
        性别：<select name="s_sex" id="s_sex">
        <option >全部</option>
        <option >男</option>
        <option >女</option>
    </select>
        <button type="button" id="searchBtn">搜索</button>
    </div>
    <table border="1" cellspacing="0">
        <thead>
            <tr>
                <th>编号</th>
                <th>学号</th>
                <th>姓名</th>
                <th>性别</th>
                <th>年龄</th>
                <th>出生年月</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
    <div id="divPage"></div>
    <form id="addForm">
        <p>学号<input type="number" name="sNo" id="sNo" placeholder="学号"></p>
        <p>姓名<input type="text" name="sName" id="sName"></p>
        <p>性别
            <select name="sex" id="sex">
                <option>男</option>
                <option>女</option>
            </select>
        </p>
        <p>年龄<input type="number" name="age" id="age"></p>
        <p>出生年月<input type="date" name="birthday" id="birthday"></p>
        <p><button type="button" id="SubBtn">提交</button><button type="button" id="quxiao">取消</button></p>
    </form>
</body>
<script src="js/jQuery%20JavaScript%20Library%20v3.4.1.js"></script>
<script src="js/ajax.js"></script>
<script>
    var addClick=-1;//判断add事件
    var totalCount;//总数量
    var totalPage;//总页数
    var currentPage=1;//默认当前页为1
    var pageSize=4;//每页显示数量

    $(function () {
        getDateFn();
        delEvent();
        addEvnet();
        subEvent();
        alterEvent();
        quxiaoEvent();
        pageBar();
        pageBtnEvent()
    })
    //添加
function addEvnet() {
        $("#addBtn").click(function () {
            $("#addForm").show();
            addClick=1
        })
}

//提交
function subEvent() {
        $("#SubBtn").click(function () {
            ajaxFn("post","add.do",true,function (data) {
                alert(data);
            },$("#addForm").serialize()+"&addclick="+addClick)
            $("#addForm").hide();
            $("#sNo").val("");
            $("#sName").val("");
            $("#age").val("");
            $("#birthday").val("");
            $("#sNo").attr('readonly',false);
            addClick=-1;
            getDateFn();
            pageBar();
        })

}
//取消
    function quxiaoEvent() {
        $("#quxiao").click(function () {
            $("#addForm").hide();
            $("#sNo").val("");
            $("#sName").val("");
            $("#age").val("");
            $("#birthday").val("");
            $("#sNo").attr('readonly',false);
            addClick=-1;
        })
    }

    //删除
    function delEvent() {
        $("#tbody").on("click",".del",function () {
            var idVal = $(this).attr("data-id");
            ajaxFn("post","del.do",true,function (data) {
                alert(data);
                getDateFn();
                pageBar();
            },"id="+idVal);
        })
    }

    //修改
    function alterEvent() {
        var obj;
        $("#tbody").on("click",".alter",function () {
            var idVal = $(this).attr("data-id");
            ajaxFn("post","alter.do",true,function (data) {
                obj = JSON.parse(data);
                $("#sNo").attr('readonly',true);
                $("#sNo").val(obj[0].s_no);
                $("#sName").val(obj[0].s_name);
                $("#sex").val(obj[0].s_sex)
                $("#age").val(obj[0].s_age);
                $("#birthday").val(obj[0].s_birthday.toString().substr(0,10));
                $("#addForm").show();
            },"id="+idVal+"&addclick="+addClick);



        })
    }


    function getDateFn() {
        var sNameVal = $("#sName").val();
        var s_sexVal = $("#s_sex").val();
        ajaxFn("post","search.do",true,function (data) {
            displayData(JSON.parse(data))
        },"sName="+sNameVal+"&s_sex="+s_sexVal+"&curPage="+currentPage+"&pageSize="+pageSize);

    }
//显示
    function displayData(arr) {
        $("#tbody").html("");
        for (var i=0;i<arr.length;i++){
            $("#tbody").append(`<tr>
                                    <td>${arr[i].s_id}</td>
                                    <td>${arr[i].s_no}</td>
                                    <td>${arr[i].s_name}</td>
                                    <td>${arr[i].s_sex}</td>
                                    <td>${arr[i].s_age}</td>
                                    <td>${arr[i].s_birthday.toString().substr(0,10)}</td>
                                    <td>
                                         <button type="button" class="alter" data-id="${arr[i].s_id}">修改</button>
                                         <button type="button" class="del" data-id="${arr[i].s_id}">删除</button>
                                    </td>
                              </tr>`)
        }
    }


    //分页,页码显示
    function pageBar() {
        var sNameVal = $("#sName").val();
        var s_sexVal = $("#s_sex").val();
        //获取总数量
        ajaxFn("post","totalCount.do",true,function (data) {
            totalCount = JSON.parse(data)[0].num;
            totalPage = Math.ceil(totalCount/pageSize);

            //添加页码
            $("#divPage").html("");
            for (var i=1; i<=totalPage;i++){
                $("#divPage").append(`<button>${i}</button>`)
            }

        },"sName="+sNameVal+"&s_sex="+s_sexVal)
    }

    //分页按钮加事件
    function pageBtnEvent() {
        $("#divPage").on("click","button",function () {
            currentPage =Number( $(this).text());
            getDateFn();
            pageBar();
        })

    }


</script>
</html>